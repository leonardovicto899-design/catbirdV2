<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gato Bird - Online Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');
        body {
            font-family: 'Fredoka', sans-serif;
            overflow: hidden;
            touch-action: none;
            background-color: #1a1a1a;
            user-select: none;
            margin: 0; padding: 0;
        }
        #game-container {
            position: relative;
            width: 100vw; height: 100vh;
            background: linear-gradient(180deg, #4facfe 0%, #00f2fe 100%);
            overflow: hidden;
        }
        canvas { display: block; z-index: 1; }
        .ui-layer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(3px);
        }
        .interactive { pointer-events: auto !important; }
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 30px;
            padding: 25px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 90%;
            width: 400px;
            border: 1px solid rgba(255,255,255,0.5);
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            animation: floatIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes floatIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .btn {
            color: white;
            padding: 12px;
            border-radius: 16px;
            font-weight: 800;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.1s;
            border-bottom: 5px solid rgba(0,0,0,0.2);
            width: 100%;
            text-transform: uppercase;
            margin-bottom: 6px;
        }
        .btn:active { transform: translateY(4px); border-bottom-width: 2px; }
        .skin-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            padding: 5px;
        }
        .skin-item {
            aspect-ratio: 1;
            border: 3px solid #e5e7eb;
            border-radius: 16px;
            cursor: pointer;
            background: #fff;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s;
            overflow: hidden;
        }
        .skin-item img { width: 100%; height: 100%; object-fit: cover; }
        .skin-item.locked { opacity: 0.4; filter: grayscale(1); background: #ddd; }
        .skin-item:active { transform: scale(0.9); }
        .skin-item.selected { border-color: #F59E0B; box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.3); z-index: 10; transform: scale(1.05); }
        #dropNotif {
            position: absolute;
            top: 15%;
            background: linear-gradient(45deg, #F59E0B, #ff7e5f);
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 800;
            border: 4px solid white;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            z-index: 100;
            animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .hidden { display: none !important; }
        
        /* Utilit√°rios Extras */
        .daily-timer { font-size: 0.7rem; background: #000; color: #10B981; padding: 2px 6px; border-radius: 4px; margin-left: 5px; }
        .leaderboard-row { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #eee; font-size: 0.9rem; font-weight: bold; }
        
        /* Estilo Not√≠cias */
        .news-item { text-align: left; background: #f3f4f6; padding: 10px; border-radius: 12px; margin-bottom: 8px; border-left: 4px solid #F59E0B; }
        .news-date { font-size: 0.7rem; color: #9ca3af; font-weight: bold; }
        .news-title { font-weight: 800; color: #374151; font-size: 1rem; }
        .news-body { font-size: 0.85rem; color: #4b5563; margin-top: 4px; line-height: 1.2; }
    </style>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        // =========================================================================
        // ‚ö†Ô∏è SUBSTITUA AQUI PELAS SUAS CHAVES DO FIREBASE
        // =========================================================================
        const firebaseConfig = {
            apiKey: "AIzaSyAh1Xzb616gPPnnmrjTJSGKp1zwosuVO7w",
            authDomain: "cat-bird.firebaseapp.com",
            projectId: "cat-bird",
            storageBucket: "cat-bird.firebasestorage.app",
            messagingSenderId: "1050244688440",
            appId: "1:1050244688440:web:168777901fb3ebb1c454cd"
        };
        // =========================================================================

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Sistema Global de Auth
        window.authSystem = {
            user: null,
            login: async () => {
                const email = document.getElementById('emailInput').value;
                const pass = document.getElementById('passInput').value;
                const msg = document.getElementById('authMsg');
                try {
                    msg.innerText = "Carregando...";
                    await signInWithEmailAndPassword(auth, email, pass);
                } catch (error) { msg.innerText = "Erro: " + error.message; }
            },
            register: async () => {
                const email = document.getElementById('emailInput').value;
                const pass = document.getElementById('passInput').value;
                const msg = document.getElementById('authMsg');
                if(pass.length < 6) return msg.innerText = "Senha deve ter 6+ d√≠gitos";
                try {
                    msg.innerText = "Criando...";
                    await createUserWithEmailAndPassword(auth, email, pass);
                } catch (error) { msg.innerText = "Erro: " + error.message; }
            },
            logout: async () => {
                await signOut(auth);
                window.location.reload();
            },
            playOffline: () => {
                document.getElementById('loginScreen').classList.add('hidden');
                if(window.gameLoadLocal) window.gameLoadLocal();
            },
            saveData: async (data) => {
                if(!window.authSystem.user) return;
                try { await setDoc(doc(db, "users", window.authSystem.user.uid), data); } 
                catch(e) { console.error("Erro nuvem:", e); }
            }
        };
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                window.authSystem.user = user;
                document.getElementById('authMsg').innerText = "Sucesso!";
                document.getElementById('logoutBtn').classList.remove('hidden');
                
                // Carregar do Banco
                const docRef = doc(db, "users", user.uid);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists() && window.gameSetState) {
                    window.gameSetState(docSnap.data());
                } else if(window.gameGetState) {
                    // Salvar estado inicial
                    window.authSystem.saveData(window.gameGetState());
                }
                document.getElementById('loginScreen').classList.add('hidden');
            }
        });
    </script>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <div id="dropNotif" class="hidden">üéÅ NOVA CAIXA! (+25 PTS)</div>

        <div id="loginScreen" class="ui-layer interactive z-50">
            <div class="card">
                <h1 class="text-4xl font-black text-orange-500 mb-2">GATO BIRD</h1>
                <p class="text-sm text-gray-400 mb-6 font-bold">SALVAR PROGRESSO NA NUVEM</p>

                <input type="email" id="emailInput" placeholder="Seu E-mail" class="w-full bg-gray-100 p-3 rounded-xl mb-3 border-2 border-gray-200 font-bold text-gray-700 outline-none focus:border-orange-400">
                <input type="password" id="passInput" placeholder="Sua Senha" class="w-full bg-gray-100 p-3 rounded-xl mb-6 border-2 border-gray-200 font-bold text-gray-700 outline-none focus:border-orange-400">

                <button class="btn bg-green-500 mb-2" onclick="authSystem.login()"><i class="fas fa-sign-in-alt mr-2"></i> ENTRAR</button>
                <button class="btn bg-blue-500 mb-4" onclick="authSystem.register()"><i class="fas fa-user-plus mr-2"></i> CRIAR CONTA</button>
                <button class="text-xs text-gray-400 font-bold hover:text-orange-500" onclick="authSystem.playOffline()">JOGAR SEM SALVAR (OFFLINE)</button>
                
                <div id="authMsg" class="mt-4 text-xs font-black text-red-500 h-4"></div>
            </div>
        </div>

        <div id="hud" class="absolute top-0 w-full p-4 flex justify-between items-start pointer-events-none z-10">
            <div class="bg-white/20 backdrop-blur-md text-white px-5 py-2 rounded-full font-black border-2 border-white/50 shadow-lg flex items-center gap-2 text-xl">
                <i class="fas fa-coins text-yellow-300 drop-shadow-md"></i> <span id="coinCountHud">0</span>
            </div>
            <div id="scoreDisplay" class="text-7xl font-black text-white drop-shadow-lg" style="-webkit-text-stroke: 3px rgba(0,0,0,0.2);">0</div>
        </div>

        <div id="menuScreen" class="ui-layer interactive">
            <div class="card">
                <h1 class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-red-500 mb-2">GATO BIRD</h1>
                
                <div class="bg-blue-50 rounded-3xl p-6 border-4 border-white shadow-inner mb-4 flex flex-col items-center relative">
                    <div class="relative w-24 h-24 mb-2 bg-white rounded-2xl shadow-sm overflow-hidden flex items-center justify-center">
                        <canvas id="menuPreview" width="100" height="100" class="w-full h-full object-contain"></canvas>
                    </div>
                    <div id="displayName" class="font-black text-2xl text-gray-800">Dion√≠sio</div>
                    <div class="flex gap-2">
                        <div id="displayRarityBadge" class="text-[10px] px-3 py-1 rounded-full font-black mt-1 text-white uppercase bg-gray-400">COMUM</div>
                        <div id="displayEffectBadge" class="text-[10px] px-3 py-1 rounded-full font-black mt-1 text-white uppercase bg-blue-400 hidden">EFEITO</div>
                    </div>
                    <div id="displayMult" class="text-xs text-yellow-600 font-bold mt-2 bg-yellow-100 px-3 py-1 rounded-full">x1 Moedas</div>
                </div>

                <div class="grid gap-2 w-full">
                    <button class="btn bg-orange-500 shadow-orange-200" onclick="game.startGame()"><i class="fas fa-play mr-2"></i> JOGAR</button>
                    <div class="grid grid-cols-2 gap-2">
                        <button class="btn bg-blue-500" onclick="game.openUI('shop')"><i class="fas fa-store mr-1"></i> LOJA</button>
                        <button class="btn bg-purple-500" onclick="game.openUI('collection')"><i class="fas fa-paw mr-1"></i> GATIL</button>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                         <button class="btn bg-yellow-500" onclick="game.openUI('leaderboard')"><i class="fas fa-trophy mr-1"></i> RANK</button>
                         <button class="btn bg-teal-500" onclick="game.openUI('news')"><i class="fas fa-newspaper mr-1"></i> NEWS</button>
                    </div>
                </div>
                <button id="logoutBtn" class="hidden text-[10px] bg-red-100 text-red-500 px-3 py-1 rounded-full font-bold mt-2" onclick="authSystem.logout()">SAIR DA CONTA</button>
            </div>
        </div>

        <div id="shopScreen" class="ui-layer interactive hidden">
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-black text-gray-800">LOJA</h2>
                    <button onclick="game.openUI('menu')" class="w-8 h-8 bg-gray-100 rounded-full font-bold">X</button>
                </div>
                <div class="bg-yellow-100 text-yellow-800 p-2 rounded-xl mb-4 font-black flex justify-between px-4 items-center">
                    <span class="text-xs opacity-70">SALDO</span> 
                    <span class="text-xl"><i class="fas fa-coins"></i> <span id="shopBalance">0</span></span>
                </div>

                <div class="bg-gray-50 border-2 border-gray-200 p-2 rounded-xl mb-4 text-left">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-black text-gray-700 text-sm flex items-center">
                            <i class="fas fa-calendar-day mr-1 text-blue-500"></i> OFERTAS DI√ÅRIAS
                            <span id="dailyTimer" class="daily-timer">00:00:00</span>
                        </h3>
                    </div>
                    <div id="dailyShopList" class="flex gap-2 justify-center"></div>
                </div>

                <h3 class="font-black text-gray-400 text-xs text-left mb-1 ml-1 uppercase">Caixas Misteriosas</h3>
                <div id="boxesContainer" class="flex flex-col gap-2 overflow-y-auto pr-1 flex-1 h-[200px]">
                    </div>
            </div>
        </div>

        <div id="newsScreen" class="ui-layer interactive hidden">
            <div class="card h-[80vh]">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-black text-teal-600"><i class="fas fa-newspaper"></i> NOT√çCIAS</h2>
                    <button onclick="game.openUI('menu')" class="w-8 h-8 bg-gray-100 rounded-full font-bold">X</button>
                </div>
                <div id="newsList" class="overflow-y-auto flex-1 text-left pr-2 custom-scrollbar">
                    </div>
            </div>
        </div>

        <div id="collectionScreen" class="ui-layer interactive hidden">
            <div class="card h-[80vh]">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-black text-gray-800">GATIL</h2>
                    <button onclick="game.openUI('menu')" class="w-8 h-8 bg-gray-100 rounded-full font-bold">X</button>
                </div>
                <div id="collectionList" class="overflow-y-auto flex-1 text-left pr-2 custom-scrollbar"></div>
            </div>
        </div>

        <div id="leaderboardScreen" class="ui-layer interactive hidden">
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-black text-yellow-600"><i class="fas fa-trophy"></i> TOP MUNDIAL</h2>
                    <button onclick="game.openUI('menu')" class="w-8 h-8 bg-gray-100 rounded-full font-bold">X</button>
                </div>
                <p class="text-xs text-gray-400 mb-4">(Tabela Provis√≥ria)</p>
                <div class="bg-white rounded-xl border border-gray-200 overflow-hidden text-left mb-4">
                    <div class="bg-gray-100 p-2 text-xs font-bold text-gray-500 flex justify-between">
                        <span>JOGADOR</span> <span>RECORD</span>
                    </div>
                    <div id="leaderboardList">
                         <div class="p-4 text-center text-gray-400 text-sm">Conectando ao servidor...</div>
                    </div>
                    <div class="leaderboard-row text-blue-600 bg-blue-50 border-t-2 border-blue-100">
                        <span>VOC√ä</span> <span id="myHighScoreRank">0</span>
                    </div>
                </div>
                <button class="btn bg-gray-500" onclick="game.openUI('menu')">VOLTAR</button>
            </div>
        </div>

        <div id="gachaScreen" class="ui-layer interactive hidden bg-black/95 z-[100]">
            <div id="boxAnim" class="text-9xl animate-bounce filter drop-shadow-[0_0_50px_rgba(255,255,0,0.5)]">üì¶</div>
            <div id="gachaResult" class="hidden flex flex-col items-center w-full">
                <div class="card">
                    <div id="gachaNewLabel" class="text-green-500 font-black tracking-widest animate-pulse mb-4 text-xl">NOVO!</div>
                    <div class="bg-gray-100 rounded-full p-6 mb-4">
                        <canvas id="gachaPreview" width="120" height="120"></canvas>
                    </div>
                    <div id="gachaName" class="text-3xl font-black text-gray-800">Nome</div>
                    <div id="gachaRarity" class="px-6 py-2 rounded-full text-white font-bold my-3 text-sm tracking-wide shadow-md">RARIDADE</div>
                    <button class="btn bg-orange-500 mt-4" onclick="game.openUI('menu')">CONTINUAR</button>
                </div>
            </div>
        </div>

        <div id="gameOverScreen" class="ui-layer interactive hidden">
            <div class="card">
                <h2 class="text-5xl font-black text-red-500 mb-6 drop-shadow-sm">FIM DE JOGO!</h2>
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="bg-gray-50 p-5 rounded-3xl border-2 border-gray-100">
                        <p class="text-xs font-bold text-gray-400 uppercase tracking-wide">Placar</p>
                        <p id="finalScore" class="text-5xl font-black text-gray-800">0</p>
                    </div>
                    <div class="bg-yellow-50 p-5 rounded-3xl border-2 border-yellow-100">
                        <p class="text-xs font-bold text-yellow-600 uppercase tracking-wide">Moedas</p>
                        <p id="finalCoins" class="text-5xl font-black text-yellow-500">0</p>
                    </div>
                </div>
                <button class="btn bg-orange-500 text-xl mb-3" onclick="game.startGame()">TENTAR DE NOVO</button>
                <button class="btn bg-gray-500" onclick="game.openUI('menu')">MENU</button>
            </div>
        </div>
    </div>

<script>
(function() {
    // =========================================================================
    // üõ†Ô∏è √ÅREA DE CONFIGURA√á√ÉO F√ÅCIL
    // =========================================================================
    
    // 1. CONFIGURA√á√ÉO DOS GATOS
    const MEUS_GATOS = [
        {
            id: 'g001',
            nome: 'Dion√≠sio',
            raridade: 'comum',
            imagem: 'https://uploads.onecompiler.io/43nbuw62r/449fq92k6/Gemini_Generated_Image_uy5y2puy5y2puy5y%20(1).png', 
            cor_padrao: '#FF9933',
            multiplicador: 1,
            efeito: 'nenhum',
            escala_imagem: 2.0,  // Aumente para 1.2, 1.5, etc para deixar maior
            aparecer_na_loja: true // Se true, aparece na loja di√°ria
        },
        {
            id: 'g002',
            nome: 'Gato Emo',
            raridade: 'comum',
            imagem: 'https://uploads.onecompiler.io/43nbuw62r/449fq92k6/Gemini_Generated_Image_oi2dkjoi2dkjoi2d%20(2).png', 
            cor_padrao: '#FF9923',
            multiplicador: 1,
            efeito: 'nenhum',
            escala_imagem: 2.0,
            aparecer_na_loja: true
        },
        // Adicione mais gatos aqui...
    ];

    // 2. CONFIGURA√á√ÉO DAS NOT√çCIAS
    const NOTICIAS = [
        {
            data: "03/01/2026",
            titulo: "Bem-vindo ao Gato Bird!",
            texto: "O jogo foi atualizado! Agora voc√™ pode ver not√≠cias e configurar o tamanho dos gatos."
        },
        {
            data: "01/01/2026",
            titulo: "Evento de Ano Novo",
            texto: "Em breve novos gatos tem√°ticos estar√£o dispon√≠veis."
        }
    ];

    // 3. CONFIGURA√á√ÉO DAS CAIXAS DA LOJA
    // Voc√™ pode adicionar ou remover caixas aqui
    const CAIXAS_LOJA = [
        { nome: "CAIXA COMUM", raridade: "comum", preco: 10, cor_btn: "bg-gray-400", icone: "üì¶" },
        { nome: "CAIXA RARA", raridade: "raro", preco: 25, cor_btn: "bg-blue-500", icone: "üì´" },
        { nome: "CAIXA √âPICA", raridade: "epico", preco: 50, cor_btn: "bg-purple-600", icone: "üéÅ" },
        { nome: "CAIXA LEND√ÅRIA", raridade: "legendario", preco: 100, cor_btn: "bg-yellow-500", icone: "üëë" },
        { nome: "CAIXA M√çTICA", raridade: "mitico", preco: 250, cor_btn: "bg-red-500", icone: "üîÆ" },
        { nome: "CAIXA SECRETA", raridade: "secreta", preco: 500, cor_btn: "bg-gray-900 border-green-500 border", icone: "üåà" }
    ];

    const RARITIES = {
        comum: { label: 'Comum', color: '#9CA3AF' },
        raro: { label: 'Raro', color: '#3B82F6' },
        epico: { label: '√âpico', color: '#A855F7' },
        legendario: { label: 'Lend√°rio', color: '#EAB308' },
        mitico: { label: 'M√≠tico', color: '#EF4444' },
        secreta: { label: 'Secreto', color: '#10B981' }
    };

    // Preload Imagens
    MEUS_GATOS.forEach(cat => {
        if(cat.imagem && cat.imagem.length > 5) {
            const img = new Image(); img.src = cat.imagem; cat.imgObj = img;
        }
    });
    // =========================================================================
    // ‚öôÔ∏è SISTEMA DE SAVE (INTEGRADO COM FIREBASE)
    // =========================================================================
    const SAVE_KEY = 'gb_custom_v3';
    let state = { coins: 0, unlocked: ['g001'], equipped: 'g001', highScore: 0 };
    // Pontes para o M√≥dulo Firebase acessar o jogo
    window.gameGetState = () => state;
    window.gameSetState = (newData) => {
        state = { ...state, ...newData };
        updateUI();
    };
    // Fun√ß√£o Offline
    window.gameLoadLocal = () => {
        try {
            const saved = localStorage.getItem(SAVE_KEY);
            if(saved) {
                state = {...state, ...JSON.parse(saved)};
                updateUI();
            }
        } catch(e) { console.log("Erro save local"); }
    };
    const save = () => {
        // 1. Local (Backup)
        localStorage.setItem(SAVE_KEY, JSON.stringify(state));
        // 2. Nuvem
        if(window.authSystem && window.authSystem.saveData) {
            window.authSystem.saveData(state);
        }
        updateUI();
    };
    // --- DAILY SHOP LOGIC ---
    let dailyShopItems = [];
    function updateDailyShop() {
        const now = Date.now();
        const savedShop = JSON.parse(localStorage.getItem('gb_daily_shop_v3'));
        if (!savedShop || now > savedShop.expires) {
            // Filtro adicionado: c.aparecer_na_loja !== false
            const pool = MEUS_GATOS.filter(c => ['comum','raro','epico','legendario'].includes(c.raridade) && c.aparecer_na_loja !== false);
            const selected = [];
            if (pool.length > 0) {
                for(let i=0; i<3; i++) { selected.push(pool[Math.floor(Math.random() * pool.length)].id); }
            }
            const newShop = { items: selected, expires: now + 86400000 };
            localStorage.setItem('gb_daily_shop_v3', JSON.stringify(newShop));
            dailyShopItems = newShop.items;
        } else { dailyShopItems = savedShop.items; }
        renderDailyShop();
    }

    function renderDailyShop() {
        const container = document.getElementById('dailyShopList');
        container.innerHTML = '';
        if(dailyShopItems.length === 0) {
             container.innerHTML = '<div class="text-xs text-gray-400 p-2">Adicione mais gatos no c√≥digo para ver a loja!</div>';
             return;
        }
        dailyShopItems.forEach(id => {
            const cat = MEUS_GATOS.find(c => c.id === id);
            if(!cat) return;
            const owned = state.unlocked.includes(id);
            const div = document.createElement('div');
            div.className = `flex flex-col items-center bg-white p-2 rounded border ${owned ? 'border-green-300 opacity-50' : 'border-gray-300'}`;
            
            const cvs = document.createElement('canvas');
            cvs.width=40; cvs.height=40;
            drawCat(cvs.getContext('2d'), cat, 20, 20, 30, 0);
            
            let price = 50;
            if(cat.raridade === 'raro') price = 150;
            if(cat.raridade === 'epico') price = 300;
            if(cat.raridade === 'legendario') price = 800;

            div.appendChild(cvs);
            div.innerHTML += `<div class="text-[9px] font-bold mt-1">${cat.nome}</div>`;
            
            const btn = document.createElement('button');
            btn.className = `text-[9px] px-2 py-1 rounded mt-1 text-white font-bold ${owned ? 'bg-green-500' : 'bg-blue-500'}`;
            btn.innerText = owned ? 'J√Å TEM' : `${price} üí∞`;
            btn.onclick = () => {
                if(owned) return;
                if(state.coins >= price) {
                    state.coins -= price;
                    state.unlocked.push(id);
                    save();
                    renderDailyShop();
                    alert(`Comprou ${cat.nome}!`);
                } else { alert('Moedas insuficientes!'); }
            };
            div.appendChild(btn);
            container.appendChild(div);
        });
        setInterval(() => {
            const savedShop = JSON.parse(localStorage.getItem('gb_daily_shop_v3'));
            if(savedShop) {
                const diff = savedShop.expires - Date.now();
                if(diff > 0) {
                    const h = Math.floor(diff / 3600000);
                    const m = Math.floor((diff % 3600000) / 60000);
                    document.getElementById('dailyTimer').innerText = `${h}h ${m}m`;
                } else { updateDailyShop(); }
            }
        }, 60000);
    }

    // --- DRAWING ENGINE ---
    function drawCat(ctx, cat, x, y, size, frame) {
        ctx.save();
        ctx.translate(x, y);

        if(cat.efeito === 'brilho' || cat.efeito === 'fogo' || cat.raridade === 'mitico') {
            ctx.shadowBlur = 15 + Math.sin(frame/10)*5;
            ctx.shadowColor = RARITIES[cat.raridade]?.color || 'gold';
            ctx.beginPath(); ctx.arc(0, 0, size/2 + 2, 0, Math.PI*2);
            ctx.fillStyle = RARITIES[cat.raridade]?.color || 'gold';
            ctx.globalAlpha = 0.3; ctx.fill(); ctx.globalAlpha = 1.0;
        }

        // L√≥gica de Tamanho (Escala)
        let drawSize = size * (cat.escala_imagem || 1.0);

        if (cat.imgObj && cat.imgObj.complete) {
            ctx.beginPath();
            // M√°scara redonda baseada no tamanho original para n√£o quebrar colis√£o visual
            ctx.arc(0, 0, size/2, 0, Math.PI*2); ctx.clip();
            // Desenha a imagem com o tamanho ajustado
            ctx.drawImage(cat.imgObj, -drawSize/2, -drawSize/2, drawSize, drawSize);
        } else {
            ctx.fillStyle = cat.cor_padrao;
            ctx.beginPath();
            ctx.arc(0, 0, size/2, 0, Math.PI*2); ctx.fill();
            // Orelhas
            ctx.beginPath();
            ctx.moveTo(-size*0.3, -size*0.3); ctx.lineTo(-size*0.4, -size*0.6); ctx.lineTo(-size*0.1, -size*0.4); ctx.fill();
            ctx.beginPath(); ctx.moveTo(size*0.3, -size*0.3); ctx.lineTo(size*0.4, -size*0.6); ctx.lineTo(size*0.1, -size*0.4); ctx.fill();
            // Rosto
            ctx.fillStyle = 'rgba(0,0,0,0.2)'; 
            ctx.beginPath();
            ctx.arc(size*0.2, -size*0.1, size*0.05, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(-size*0.2, -size*0.1, size*0.05, 0, Math.PI*2); ctx.fill();
        }
        ctx.restore();
    }

    // --- GAME ENGINE ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let frames=0, score=0, playing=false, trail=[];
    let speed=3.5, gravity=0.25;
    const bird = {
        x: 60, y: 150, v: 0,
        update: function() {
            this.v += gravity;
            this.y += this.v;
            if(this.y + 15 > canvas.height) gameOver();
            if(this.y < 0) this.y = 0;
            const cat = MEUS_GATOS.find(c => c.id === state.equipped);
            if(cat && (cat.efeito === 'rastro' || cat.efeito === 'arco_iris' || cat.efeito === 'fogo')) {
                trail.push({x: this.x, y: this.y, age: 0});
                if(trail.length > 20) trail.shift();
            }
        },
        draw: function() {
            const cat = MEUS_GATOS.find(c => c.id === state.equipped) || MEUS_GATOS[0];
            trail.forEach((t, i) => {
                t.age++;
                let opacity = i / trail.length;
                let size = 20 * opacity;

                if(cat.efeito === 'arco_iris') {
                    const cols = ['#f00','#fa0','#ff0','#0f0','#09f','#50f'];
                    ctx.fillStyle = cols[i%6];
                    ctx.fillRect(t.x-20+(i*2), t.y-10, 6, 20);
                } else if (cat.efeito === 'fogo') {
                    ctx.fillStyle = `rgba(255, 100, 0, ${opacity})`;
                    ctx.beginPath(); ctx.arc(t.x, t.y, size/2 + Math.random()*5, 0, Math.PI*2); ctx.fill();
                } else if (cat.efeito === 'rastro') {
                    ctx.fillStyle = RARITIES[cat.raridade]?.color || '#fff';
                    ctx.globalAlpha = 0.5 * opacity;
                    ctx.beginPath(); ctx.arc(t.x, t.y, size/2, 0, Math.PI*2); ctx.fill();
                    ctx.globalAlpha = 1.0;
                }
            });
            drawCat(ctx, cat, this.x, this.y, 45, frames);
        },
        jump: function() { this.v = -6; }
    };

    const pipes = {
        list: [],
        update: function() {
            if(frames % 100 === 0) {
                let gap = 160;
                let y = Math.random() * (canvas.height - 350) + 100;
                this.list.push({x: canvas.width, y, gap, scored: false});
            }
            this.list.forEach(p => {
                p.x -= speed;
                if(bird.x + 15 > p.x && bird.x - 15 < p.x + 60) {
                    if(bird.y - 15 < p.y || bird.y + 15 > p.y + p.gap) gameOver();
                }
                if(p.x + 60 < bird.x && !p.scored) {
                    p.scored = true;
                    score++;
                    const cat = MEUS_GATOS.find(c => c.id === state.equipped);
                    state.coins += (cat ? cat.multiplicador : 1);
                    document.getElementById('scoreDisplay').innerText = score;
                    if(score % 25 === 0) spawnBonus();
                }
            });
            if(this.list[0]?.x < -100) this.list.shift();
        },
        draw: function() {
            ctx.fillStyle = '#22C55E';
            ctx.strokeStyle = '#14532D';
            ctx.lineWidth = 4;
            this.list.forEach(p => {
                ctx.fillRect(p.x, 0, 60, p.y);
                ctx.strokeRect(p.x, -2, 60, p.y+2);
                ctx.fillRect(p.x-5, p.y-25, 70, 25);
                ctx.strokeRect(p.x-5, p.y-25, 70, 25);
                
                let by = p.y + p.gap;
                ctx.fillRect(p.x, by, 60, canvas.height-by);
                ctx.strokeRect(p.x, by, 60, canvas.height-by);
                ctx.fillRect(p.x-5, by, 70, 25);
                ctx.strokeRect(p.x-5, by, 70, 25);
                ctx.fillStyle = 'rgba(255,255,255,0.2)';
                ctx.fillRect(p.x+5, 0, 10, p.y-25);
                ctx.fillRect(p.x+5, by+25, 10, canvas.height);
                ctx.fillStyle = '#22C55E';
            });
        }
    };

    function spawnBonus() {
        const d = document.getElementById('dropNotif');
        d.classList.remove('hidden');
        if(MEUS_GATOS.length > 1) {
            const win = MEUS_GATOS[Math.floor(Math.random()*MEUS_GATOS.length)];
            if(!state.unlocked.includes(win.id)) state.unlocked.push(win.id);
            save();
        }
        setTimeout(() => d.classList.add('hidden'), 2500);
    }

    function loop() {
        if(canvas.width!==window.innerWidth) { canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
        ctx.clearRect(0,0,canvas.width,canvas.height);
        if(playing) { bird.update(); pipes.update(); frames++; }
        pipes.draw();
        bird.draw();
        if(!playing && !document.getElementById('menuScreen').classList.contains('hidden')) {
            const mCtx = document.getElementById('menuPreview').getContext('2d');
            mCtx.clearRect(0,0,100,100);
            drawCat(mCtx, MEUS_GATOS.find(c => c.id === state.equipped), 50, 50, 80, frames);
        }
        requestAnimationFrame(loop);
    }
    loop();

    function gameOver() {
        playing = false;
        if(score > state.highScore) state.highScore = score;
        save();
        document.getElementById('gameOverScreen').classList.remove('hidden');
        document.getElementById('finalScore').innerText = score;
        document.getElementById('finalCoins').innerText = state.coins;
    }

    // --- UI CONTROLLER ---
    window.game = {
        startGame: () => {
            playing = true;
            score = 0; frames = 0; trail = [];
            bird.y = canvas.height/2; bird.v = 0;
            pipes.list = [];
            document.querySelectorAll('.ui-layer').forEach(l => l.classList.add('hidden'));
            document.getElementById('hud').classList.remove('hidden');
            document.getElementById('scoreDisplay').innerText = '0';
        },
        openUI: (name) => {
            document.querySelectorAll('.ui-layer').forEach(l => l.classList.add('hidden'));
            document.getElementById(name+'Screen').classList.remove('hidden');
            if(name === 'menu') updateUI();
            if(name === 'shop') {
                document.getElementById('shopBalance').innerText = state.coins;
                updateDailyShop();
                renderShopBoxes(); // Renderiza as caixas configuradas
            }
            if(name === 'collection') renderCollection();
            if(name === 'news') renderNews();
            if(name === 'leaderboard') {
                 document.getElementById('myHighScoreRank').innerText = state.highScore;
            }
        },
        buyBox: (tier, cost) => {
            if(state.coins < cost) return alert("Moedas insuficientes!");
            const pool = MEUS_GATOS.filter(c => c.raridade === tier);
            if(pool.length === 0) return alert("Nenhum gato dessa raridade adicionado no c√≥digo ainda!");
            state.coins -= cost;
            save();

            const win = pool[Math.floor(Math.random()*pool.length)];
            const isNew = !state.unlocked.includes(win.id);
            if(isNew) state.unlocked.push(win.id);
            else state.coins += Math.floor(cost*0.2);
            save();

            document.getElementById('shopScreen').classList.add('hidden');
            document.getElementById('gachaScreen').classList.remove('hidden');
            document.getElementById('boxAnim').classList.remove('hidden');
            document.getElementById('gachaResult').classList.add('hidden');
            
            setTimeout(() => {
                document.getElementById('boxAnim').classList.add('hidden');
                document.getElementById('gachaResult').classList.remove('hidden');
                document.getElementById('gachaNewLabel').innerText = isNew ? "NOVO GATO!" : "REPETIDO (+B√îNUS)";
                document.getElementById('gachaName').innerText = win.nome;
                document.getElementById('gachaRarity').innerText = RARITIES[win.raridade]?.label || 'Especial';
                document.getElementById('gachaRarity').style.backgroundColor = RARITIES[win.raridade]?.color || '#000';
                const gCtx = document.getElementById('gachaPreview').getContext('2d');
                gCtx.clearRect(0,0,120,120);
                drawCat(gCtx, win, 60, 60, 90, 0);
            }, 1000);
        }
    };

    function renderShopBoxes() {
        const container = document.getElementById('boxesContainer');
        container.innerHTML = '';
        CAIXAS_LOJA.forEach(box => {
            const btn = document.createElement('button');
            btn.className = `btn ${box.cor_btn} flex justify-between items-center p-2`;
            btn.onclick = () => game.buyBox(box.raridade, box.preco);
            btn.innerHTML = `
                <div class="flex items-center gap-2"><span class="text-xl">${box.icone}</span> <span class="text-sm uppercase">${box.nome}</span></div> 
                <span>${box.preco} üí∞</span>
            `;
            container.appendChild(btn);
        });
    }

    function renderNews() {
        const container = document.getElementById('newsList');
        container.innerHTML = '';
        if(NOTICIAS.length === 0) {
            container.innerHTML = '<div class="text-gray-400 p-4">Nenhuma not√≠cia no momento.</div>';
            return;
        }
        NOTICIAS.forEach(news => {
            const div = document.createElement('div');
            div.className = 'news-item';
            div.innerHTML = `
                <div class="news-date">${news.data}</div>
                <div class="news-title">${news.titulo}</div>
                <div class="news-body">${news.texto}</div>
            `;
            container.appendChild(div);
        });
    }

    function updateUI() {
        const cat = MEUS_GATOS.find(c => c.id === state.equipped) || MEUS_GATOS[0];
        document.getElementById('displayName').innerText = cat.nome;
        const rInfo = RARITIES[cat.raridade];
        document.getElementById('displayRarityBadge').innerText = rInfo ? rInfo.label : 'COMUM';
        document.getElementById('displayRarityBadge').style.backgroundColor = rInfo ? rInfo.color : '#999';
        
        if(cat.efeito && cat.efeito !== 'nenhum') {
            document.getElementById('displayEffectBadge').classList.remove('hidden');
            document.getElementById('displayEffectBadge').innerText = cat.efeito.toUpperCase();
        } else {
            document.getElementById('displayEffectBadge').classList.add('hidden');
        }
        document.getElementById('displayMult').innerText = `x${cat.multiplicador} Moedas`;
        document.getElementById('coinCountHud').innerText = state.coins;
    }

    function renderCollection() {
        const container = document.getElementById('collectionList');
        container.innerHTML = '';
        const tiers = ['comum','raro','epico','legendario','mitico','secreta'];
        
        tiers.forEach(t => {
            const pool = MEUS_GATOS.filter(c => c.raridade === t);
            if(pool.length === 0) return;
            const unlocked = pool.filter(c => state.unlocked.includes(c.id)).length;
            
            const div = document.createElement('div');
            div.className = 'cat-section-title';
            div.innerHTML = `<span>${RARITIES[t].label}</span> <span>${unlocked}/${pool.length}</span>`;
            container.appendChild(div);

            const grid = document.createElement('div');
            grid.className = 'skin-grid';
            pool.forEach(cat => {
                const owned = state.unlocked.includes(cat.id);
                const item = document.createElement('div');
                item.className = `skin-item ${owned ? '' : 'locked'} ${state.equipped === cat.id ? 'selected' : ''}`;
                
                const cvs = document.createElement('canvas');
                cvs.width = 40; cvs.height = 40;
                drawCat(cvs.getContext('2d'), cat, 20, 20, 30, 0);
                item.appendChild(cvs);
                item.onclick = () => {
                    if(owned) { state.equipped = cat.id; save(); renderCollection(); }
                };
                grid.appendChild(item);
            });
            container.appendChild(grid);
        });
    }

    window.addEventListener('mousedown', e => { if(!e.target.closest('.interactive') && playing) bird.jump(); });
    window.addEventListener('touchstart', e => { if(!e.target.closest('.interactive') && playing) { e.preventDefault(); bird.jump(); } }, {passive:false});
    window.addEventListener('keydown', e => { if(e.code==='Space' && playing) bird.jump(); });

    updateUI();
})();
</script>
</body>
</html>
